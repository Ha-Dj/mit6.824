000482 LOG1 S0, making...
000555 LOG1 S1, making...
000557 LOG1 S2, making...
Test (2B): basic agreement ...
004666 TIMR S1 T0 follower election timeout, converting to Candidate
004680 VOTE S0 T0 vote for S1, converting to follower.
004681 TIMR S0 T1 reset election timeout. (RequestVote: 0 vote for 1)
004684 LEAD S1 T1 achieved majority for term(2), 1 > 1 , converting to Leader! 
004687 VOTE S2 T0 vote for S1, converting to follower.
004687 TIMR S2 T1 reset election timeout. (RequestVote: 2 vote for 1)
004706 TIMR S0 T1 reset election timeout. (HeartBeat: 1 -> 0, commitIndex 0)
004706 TIMR S2 T1 reset election timeout. (HeartBeat: 1 -> 2, commitIndex 0)
004874 CLNT S1 leader Term 1 append new log nextIndex2 matchIndex1
004984 LEAD S1 leader Term 1 Broadcast appendEntries
004986 LEAD S1 prevIndex0
004986 LEAD S1 prevIndex0
005068 LOG2 S2 follower Term1 append new log, len(rf.log) 1, args.PrevLogIndex 0
005069 WARN S2 follower Term1 append new log, len 2
005072 LEAD S1 leader Term 1 appendEntries success: commitIndex1
005080 LOG2 S0 follower Term1 append new log, len(rf.log) 1, args.PrevLogIndex 0
005081 WARN S0 follower Term1 append new log, len 2
005085 CMIT S1 leader Term1 commit{CommandIndex:1}
005088 CMIT S1 leader Term1 commit
005818 LEAD S1 leader Term 1 appendEntries success: commitIndex1
008381 TIMR S2 T1 reset election timeout. (HeartBeat: 1 -> 2, commitIndex 0)
008384 TIMR S0 T1 reset election timeout. (HeartBeat: 1 -> 0, commitIndex 0)
008478 CMIT S0 follower Term1 commit{CommandIndex:1}
008479 CMIT S0 follower Term1 commit
008895 CMIT S2 follower Term1 commit{CommandIndex:1}
008957 CMIT S2 follower Term1 commit
009177 CLNT S1 leader Term 1 append new log nextIndex3 matchIndex2
009279 LEAD S1 leader Term 1 Broadcast appendEntries
009280 LEAD S1 prevIndex1
009281 LEAD S1 prevIndex1
009294 LOG2 S2 follower Term1 append new log, len(rf.log) 2, args.PrevLogIndex 1
009294 WARN S2 follower Term1 append new log, len 3
009297 LEAD S1 leader Term 1 appendEntries success: commitIndex2
009373 CMIT S1 leader Term1 commit{CommandIndex:2}
009374 CMIT S1 leader Term1 commit
009432 LOG2 S0 follower Term1 append new log, len(rf.log) 2, args.PrevLogIndex 1
009433 WARN S0 follower Term1 append new log, len 3
009439 LEAD S1 leader Term 1 appendEntries success: commitIndex2
011189 TIMR S2 T1 reset election timeout. (HeartBeat: 1 -> 2, commitIndex 1)
011191 CMIT S2 follower Term1 commit{CommandIndex:2}
011191 CMIT S2 follower Term1 commit
011191 TIMR S0 T1 reset election timeout. (HeartBeat: 1 -> 0, commitIndex 1)
011193 CMIT S0 follower Term1 commit{CommandIndex:2}
011194 CMIT S0 follower Term1 commit
012535 CLNT S1 leader Term 1 append new log nextIndex4 matchIndex3
012641 LEAD S1 leader Term 1 Broadcast appendEntries
012655 LEAD S1 prevIndex2
012656 LEAD S1 prevIndex2
012838 LOG2 S2 follower Term1 append new log, len(rf.log) 3, args.PrevLogIndex 2
012839 WARN S2 follower Term1 append new log, len 4
012842 LEAD S1 leader Term 1 appendEntries success: commitIndex3
012842 LOG2 S0 follower Term1 append new log, len(rf.log) 3, args.PrevLogIndex 2
012843 WARN S0 follower Term1 append new log, len 4
==================
WARNING: DATA RACE
Read at 0x00c0000d41e0 by goroutine 31:
  6.824/raft.(*Raft).startHeartBeat.func1()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:377 +0xc0

Previous write at 0x00c0000d41e0 by goroutine 64:
  6.824/raft.(*Raft).LeaderAppendEntries.func1()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:687 +0x488
  6.824/raft.(*Raft).LeaderAppendEntries.func2()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:703 +0xbc

Goroutine 31 (running) created at:
  6.824/raft.(*Raft).startHeartBeat()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:368 +0xb4
  6.824/raft.(*Raft).startElection.func3()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:591 +0x34

Goroutine 64 (finished) created at:
  6.824/raft.(*Raft).LeaderAppendEntries()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:663 +0x76c
  6.824/raft.Make.func2()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:778 +0x34
==================
012863 TIMR S2 T1 reset election timeout. (HeartBeat: 1 -> 2, commitIndex 2)
012867 TIMR S0 T1 reset election timeout. (HeartBeat: 1 -> 0, commitIndex 2)
012962 CMIT S0 follower Term1 commit{CommandIndex:3}
012962 CMIT S0 follower Term1 commit
012963 CMIT S2 follower Term1 commit{CommandIndex:3}
012963 CMIT S2 follower Term1 commit
012846 LEAD S1 leader Term 1 appendEntries success: commitIndex3
012966 CMIT S1 leader Term1 commit{CommandIndex:3}
012967 CMIT S1 leader Term1 commit
--- FAIL: TestBasicAgree2B (1.30s)
    testing.go:1465: race detected during execution of test
FAIL
exit status 1
FAIL	6.824/raft	13.477s

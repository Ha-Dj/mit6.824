000057 LOG1 S0, making...
000068 LOG1 S1, making...
000070 LOG1 S2, making...
Test (2B): basic agreement ...
004549 TIMR S1 T0 follower election timeout, converting to Candidate
004574 VOTE S0 T0 vote for S1, converting to follower.
004574 TIMR S0 T1 reset election timeout. (RequestVote: 0 vote for 1)
004576 TIMR S0 T1 follower election timeout, converting to Candidate
004582 VOTE S2 T0 vote for S0, converting to follower.
004583 TIMR S2 T2 reset election timeout. (RequestVote: 2 vote for 0)
004597 LEAD S1 T1 achieved majority for term(2), 1 > 1 , converting to Leader! 
004629 TERM S1 T1 converting to follower. Term too small (1 -> 2)
==================
WARNING: DATA RACE
Write at 0x00c0000d21b8 by goroutine 24:
  6.824/raft.(*Raft).startElection.func1()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:558 +0x218
  6.824/raft.(*Raft).startElection.func2()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:566 +0x44

Previous read at 0x00c0000d21b8 by goroutine 35:
  6.824/raft.(*Raft).startHeartBeat()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:367 +0x30
  6.824/raft.(*Raft).startElection.func3()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:591 +0x34

Goroutine 24 (running) created at:
  6.824/raft.(*Raft).startElection()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:548 +0x318
  6.824/raft.(*Raft).ticker.func1()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:615 +0x34

Goroutine 35 (finished) created at:
  6.824/raft.(*Raft).startElection()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:591 +0x550
  6.824/raft.(*Raft).ticker.func1()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:615 +0x34
==================
004643 TIMR S1 T2 reset election timeout. (RequestVote: 1 vote for 0)
004617 LEAD S0 T2 achieved majority for term(2), 1 > 2 , converting to Leader! 
004735 TIMR S1 T2 reset election timeout. (HeartBeat: 0 -> 1, commitIndex 0)
004742 TIMR S2 T2 reset election timeout. (HeartBeat: 0 -> 2, commitIndex 0)
005407 CLNT S0 leader Term 2 append new log nextIndex2 matchIndex1
005483 LEAD S0 leader Term 2 Broadcast appendEntries
005484 LEAD S0 prevIndex0
005485 LEAD S0 prevIndex0
005524 LOG2 S1 follower Term2 append new log, len(rf.log) 1, args.PrevLogIndex 0
005525 WARN S1 follower Term2 append new log, len 2
005528 LEAD S0 leader Term 2 appendEntries success: commitIndex1
005534 LOG2 S2 follower Term2 append new log, len(rf.log) 1, args.PrevLogIndex 0
005544 WARN S2 follower Term2 append new log, len 2
005547 LEAD S0 leader Term 2 appendEntries success: commitIndex1
005646 CMIT S0 leader Term2 commit{CommandIndex:1}
005647 CMIT S0 leader Term2 commit
006253 TIMR S2 T2 reset election timeout. (HeartBeat: 0 -> 2, commitIndex 0)
006257 CMIT S2 follower Term2 commit{CommandIndex:1}
006257 CMIT S2 follower Term2 commit
006394 TIMR S1 T2 reset election timeout. (HeartBeat: 0 -> 1, commitIndex 0)
006501 CMIT S1 follower Term2 commit{CommandIndex:1}
006502 CMIT S1 follower Term2 commit
007073 CLNT S0 leader Term 2 append new log nextIndex3 matchIndex2
007180 LEAD S0 leader Term 2 Broadcast appendEntries
007181 LEAD S0 prevIndex1
007181 LEAD S0 prevIndex1
007192 LOG2 S1 follower Term2 append new log, len(rf.log) 2, args.PrevLogIndex 1
007192 WARN S1 follower Term2 append new log, len 3
007195 LEAD S0 leader Term 2 appendEntries success: commitIndex2
007235 LOG2 S2 follower Term2 append new log, len(rf.log) 2, args.PrevLogIndex 1
007235 WARN S2 follower Term2 append new log, len 3
007238 LEAD S0 leader Term 2 appendEntries success: commitIndex2
007333 CMIT S0 leader Term2 commit{CommandIndex:2}
007334 CMIT S0 leader Term2 commit
007908 TIMR S2 T2 reset election timeout. (HeartBeat: 0 -> 2, commitIndex 1)
007908 TIMR S1 T2 reset election timeout. (HeartBeat: 0 -> 1, commitIndex 1)
008039 CMIT S1 follower Term2 commit{CommandIndex:2}
008040 CMIT S1 follower Term2 commit
008073 CMIT S2 follower Term2 commit{CommandIndex:2}
008073 CMIT S2 follower Term2 commit
008107 CLNT S0 leader Term 2 append new log nextIndex4 matchIndex3
008352 LEAD S0 leader Term 2 Broadcast appendEntries
008464 LEAD S0 prevIndex2
008465 LEAD S0 prevIndex2
008527 LOG2 S1 follower Term2 append new log, len(rf.log) 3, args.PrevLogIndex 2
008527 WARN S1 follower Term2 append new log, len 4
008698 LEAD S0 leader Term 2 appendEntries success: commitIndex3
008699 CMIT S0 leader Term2 commit{CommandIndex:3}
008700 CMIT S0 leader Term2 commit
008709 LOG2 S2 follower Term2 append new log, len(rf.log) 3, args.PrevLogIndex 2
008709 WARN S2 follower Term2 append new log, len 4
008712 LEAD S0 leader Term 2 appendEntries success: commitIndex3
009414 TIMR S1 T2 reset election timeout. (HeartBeat: 0 -> 1, commitIndex 2)
009436 TIMR S2 T2 reset election timeout. (HeartBeat: 0 -> 2, commitIndex 2)
009440 CMIT S2 follower Term2 commit{CommandIndex:3}
009440 CMIT S2 follower Term2 commit
009440 CMIT S1 follower Term2 commit{CommandIndex:3}
009441 CMIT S1 follower Term2 commit
--- FAIL: TestBasicAgree2B (0.96s)
    testing.go:1465: race detected during execution of test
FAIL
exit status 1
FAIL	6.824/raft	11.687s

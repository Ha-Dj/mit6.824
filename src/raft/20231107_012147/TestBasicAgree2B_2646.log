000014 LOG1 S0, making...
000023 LOG1 S1, making...
000025 LOG1 S2, making...
Test (2B): basic agreement ...
003687 TIMR S2 T0 follower election timeout, converting to Candidate
003736 VOTE S1 T0 vote for S2, converting to follower.
003737 TIMR S1 T1 reset election timeout. (RequestVote: 1 vote for 2)
003742 LEAD S2 T1 achieved majority for term(2), 1 > 1 , converting to Leader! 
003750 TERM S0 T0 converting to follower. Term too small (0 -> 1)
003751 TIMR S0 T1 reset election timeout. (HeartBeat: 2 -> 0, commitIndex 0)
003756 TIMR S0 T1 reset election timeout. (RequestVote: 0 vote for 2)
003774 TIMR S1 T1 reset election timeout. (HeartBeat: 2 -> 1, commitIndex 0)
004176 CLNT S2 leader Term 1 append new log nextIndex2 matchIndex1
004238 LEAD S2 leader Term 1 Broadcast appendEntries
004238 LEAD S2 prevIndex0
004262 LEAD S2 prevIndex0
004283 LOG2 S0 follower Term1 append new log, len(rf.log) 1, args.PrevLogIndex 0
004284 WARN S0 follower Term1 append new log, len 2
004288 LEAD S2 leader Term 1 appendEntries success: commitIndex1
004302 CMIT S2 leader Term1 commit{CommandIndex:1}
004303 CMIT S2 leader Term1 commit
004321 LOG2 S1 follower Term1 append new log, len(rf.log) 1, args.PrevLogIndex 0
004323 WARN S1 follower Term1 append new log, len 2
004453 LEAD S2 leader Term 1 appendEntries success: commitIndex1
004751 TIMR S0 T1 reset election timeout. (HeartBeat: 2 -> 0, commitIndex 0)
004751 TIMR S1 T1 reset election timeout. (HeartBeat: 2 -> 1, commitIndex 0)
004798 CMIT S0 follower Term1 commit{CommandIndex:1}
004799 CMIT S0 follower Term1 commit
004805 CMIT S1 follower Term1 commit{CommandIndex:1}
004806 CMIT S1 follower Term1 commit
005148 CLNT S2 leader Term 1 append new log nextIndex3 matchIndex2
005281 LEAD S2 leader Term 1 Broadcast appendEntries
005282 LEAD S2 prevIndex1
005282 LEAD S2 prevIndex1
005475 LOG2 S1 follower Term1 append new log, len(rf.log) 2, args.PrevLogIndex 1
005476 WARN S1 follower Term1 append new log, len 3
005479 LEAD S2 leader Term 1 appendEntries success: commitIndex2
005519 CMIT S2 leader Term1 commit{CommandIndex:2}
005540 CMIT S2 leader Term1 commit
005603 LOG2 S0 follower Term1 append new log, len(rf.log) 2, args.PrevLogIndex 1
005604 WARN S0 follower Term1 append new log, len 3
005864 LEAD S2 leader Term 1 appendEntries success: commitIndex2
005871 TIMR S0 T1 reset election timeout. (HeartBeat: 2 -> 0, commitIndex 1)
005879 CMIT S0 follower Term1 commit{CommandIndex:2}
005880 CMIT S0 follower Term1 commit
005880 TIMR S1 T1 reset election timeout. (HeartBeat: 2 -> 1, commitIndex 1)
005929 CMIT S1 follower Term1 commit{CommandIndex:2}
005930 CMIT S1 follower Term1 commit
006143 CLNT S2 leader Term 1 append new log nextIndex4 matchIndex3
006248 LEAD S2 leader Term 1 Broadcast appendEntries
006249 LEAD S2 prevIndex2
006320 LEAD S2 prevIndex2
006721 LOG2 S0 follower Term1 append new log, len(rf.log) 3, args.PrevLogIndex 2
006721 WARN S0 follower Term1 append new log, len 4
007056 TIMR S0 T1 reset election timeout. (HeartBeat: 2 -> 0, commitIndex 2)
007060 TIMR S1 T1 reset election timeout. (HeartBeat: 2 -> 1, commitIndex 2)
007091 LOG2 S1 follower Term1 append new log, len(rf.log) 3, args.PrevLogIndex 2
==================
WARNING: DATA RACE
Write at 0x00c0000d22a0 by goroutine 63:
  6.824/raft.(*Raft).LeaderAppendEntries.func1()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:689 +0x488
  6.824/raft.(*Raft).LeaderAppendEntries.func2()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:705 +0xbc

Previous read at 0x00c0000d22a0 by goroutine 31:
  6.824/raft.(*Raft).startHeartBeat.func1()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:379 +0xc0

Goroutine 63 (running) created at:
  6.824/raft.(*Raft).LeaderAppendEntries()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:665 +0x76c
  6.824/raft.Make.func2()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:780 +0x34

Goroutine 31 (running) created at:
  6.824/raft.(*Raft).startHeartBeat()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:370 +0xc0
  6.824/raft.(*Raft).startElection.func3()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:593 +0x34
==================
007154 LEAD S2 leader Term 1 appendEntries success: commitIndex3
007164 CMIT S2 leader Term1 commit{CommandIndex:3}
007164 CMIT S2 leader Term1 commit
007146 WARN S1 follower Term1 append new log, len 4
007242 LEAD S2 leader Term 1 appendEntries success: commitIndex3
008178 TIMR S0 T1 reset election timeout. (HeartBeat: 2 -> 0, commitIndex 2)
008181 TIMR S1 T1 reset election timeout. (HeartBeat: 2 -> 1, commitIndex 2)
008182 CMIT S1 follower Term1 commit{CommandIndex:3}
008182 CMIT S1 follower Term1 commit
008183 CMIT S0 follower Term1 commit{CommandIndex:3}
008183 CMIT S0 follower Term1 commit
--- FAIL: TestBasicAgree2B (0.84s)
    testing.go:1465: race detected during execution of test
FAIL
exit status 1
FAIL	6.824/raft	3.088s

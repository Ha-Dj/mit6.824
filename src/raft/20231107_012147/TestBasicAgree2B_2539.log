000020 LOG1 S0, making...
000029 LOG1 S1, making...
000031 LOG1 S2, making...
Test (2B): basic agreement ...
003664 TIMR S1 T0 follower election timeout, converting to Candidate
003708 VOTE S0 T0 vote for S1, converting to follower.
003709 TIMR S0 T1 reset election timeout. (RequestVote: 0 vote for 1)
003711 LEAD S1 T1 achieved majority for term(2), 1 > 1 , converting to Leader! 
003739 TERM S2 T0 converting to follower. Term too small (0 -> 1)
003740 TIMR S2 T1 reset election timeout. (HeartBeat: 1 -> 2, commitIndex 0)
003750 TIMR S0 T1 reset election timeout. (HeartBeat: 1 -> 0, commitIndex 0)
003750 TIMR S2 T1 reset election timeout. (RequestVote: 2 vote for 1)
004194 CLNT S1 leader Term 1 append new log nextIndex2 matchIndex1
004257 LEAD S1 leader Term 1 Broadcast appendEntries
004259 LEAD S1 prevIndex0
004260 LEAD S1 prevIndex0
004486 LOG2 S2 follower Term1 append new log, len(rf.log) 1, args.PrevLogIndex 0
004487 WARN S2 follower Term1 append new log, len 2
004491 LEAD S1 leader Term 1 appendEntries success: commitIndex1
004541 CMIT S1 leader Term1 commit{CommandIndex:1}
004542 CMIT S1 leader Term1 commit
004625 LOG2 S0 follower Term1 append new log, len(rf.log) 1, args.PrevLogIndex 0
004626 WARN S0 follower Term1 append new log, len 2
004630 LEAD S1 leader Term 1 appendEntries success: commitIndex1
004724 TIMR S0 T1 reset election timeout. (HeartBeat: 1 -> 0, commitIndex 0)
004727 TIMR S2 T1 reset election timeout. (HeartBeat: 1 -> 2, commitIndex 0)
004893 CMIT S2 follower Term1 commit{CommandIndex:1}
004894 CMIT S2 follower Term1 commit
004894 CMIT S0 follower Term1 commit{CommandIndex:1}
004895 CMIT S0 follower Term1 commit
005101 CLNT S1 leader Term 1 append new log nextIndex3 matchIndex2
005127 LEAD S1 leader Term 1 Broadcast appendEntries
005128 LEAD S1 prevIndex1
005128 LEAD S1 prevIndex1
005134 LOG2 S2 follower Term1 append new log, len(rf.log) 2, args.PrevLogIndex 1
005134 WARN S2 follower Term1 append new log, len 3
005137 LEAD S1 leader Term 1 appendEntries success: commitIndex2
005137 LOG2 S0 follower Term1 append new log, len(rf.log) 2, args.PrevLogIndex 1
005137 WARN S0 follower Term1 append new log, len 3
005146 LEAD S1 leader Term 1 appendEntries success: commitIndex2
005187 CMIT S1 leader Term1 commit{CommandIndex:2}
005188 CMIT S1 leader Term1 commit
006379 TIMR S2 T1 reset election timeout. (HeartBeat: 1 -> 2, commitIndex 1)
006476 CMIT S2 follower Term1 commit{CommandIndex:2}
006477 CMIT S2 follower Term1 commit
006480 TIMR S0 T1 reset election timeout. (HeartBeat: 1 -> 0, commitIndex 1)
006534 CMIT S0 follower Term1 commit{CommandIndex:2}
006534 CMIT S0 follower Term1 commit
007166 CLNT S1 leader Term 1 append new log nextIndex4 matchIndex3
007413 LEAD S1 leader Term 1 Broadcast appendEntries
007427 LEAD S1 prevIndex2
007427 LEAD S1 prevIndex2
007503 LOG2 S0 follower Term1 append new log, len(rf.log) 3, args.PrevLogIndex 2
007503 WARN S0 follower Term1 append new log, len 4
==================
WARNING: DATA RACE
Write at 0x00c0001a01e0 by goroutine 63:
  6.824/raft.(*Raft).LeaderAppendEntries.func1()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:689 +0x488
  6.824/raft.(*Raft).LeaderAppendEntries.func2()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:705 +0xbc

Previous read at 0x00c0001a01e0 by goroutine 32:
  6.824/raft.(*Raft).startHeartBeat.func1()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:379 +0xc0

Goroutine 63 (running) created at:
  6.824/raft.(*Raft).LeaderAppendEntries()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:665 +0x76c
  6.824/raft.Make.func2()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:780 +0x34

Goroutine 32 (running) created at:
  6.824/raft.(*Raft).startHeartBeat()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:370 +0xc0
  6.824/raft.(*Raft).startElection.func3()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:593 +0x34
==================
007512 LEAD S1 leader Term 1 appendEntries success: commitIndex3
007515 TIMR S2 T1 reset election timeout. (HeartBeat: 1 -> 2, commitIndex 2)
007517 CMIT S1 leader Term1 commit{CommandIndex:3}
007519 CMIT S1 leader Term1 commit
007529 LOG2 S2 follower Term1 append new log, len(rf.log) 3, args.PrevLogIndex 2
007537 WARN S2 follower Term1 append new log, len 4
007540 LEAD S1 leader Term 1 appendEntries success: commitIndex3
007613 TIMR S0 T1 reset election timeout. (HeartBeat: 1 -> 0, commitIndex 2)
008587 TIMR S0 T1 reset election timeout. (HeartBeat: 1 -> 0, commitIndex 2)
008593 TIMR S2 T1 reset election timeout. (HeartBeat: 1 -> 2, commitIndex 2)
008647 CMIT S0 follower Term1 commit{CommandIndex:3}
008648 CMIT S0 follower Term1 commit
008666 CMIT S2 follower Term1 commit{CommandIndex:3}
008667 CMIT S2 follower Term1 commit
--- FAIL: TestBasicAgree2B (0.88s)
    testing.go:1465: race detected during execution of test
FAIL
exit status 1
FAIL	6.824/raft	5.131s

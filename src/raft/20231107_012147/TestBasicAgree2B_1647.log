000010 LOG1 S0, making...
000020 LOG1 S1, making...
000022 LOG1 S2, making...
Test (2B): basic agreement ...
004538 TIMR S2 T0 follower election timeout, converting to Candidate
004556 VOTE S0 T0 vote for S2, converting to follower.
004557 TIMR S0 T1 reset election timeout. (RequestVote: 0 vote for 2)
004560 VOTE S1 T0 vote for S2, converting to follower.
004561 TIMR S1 T1 reset election timeout. (RequestVote: 1 vote for 2)
004564 LEAD S2 T1 achieved majority for term(2), 1 > 1 , converting to Leader! 
004576 TIMR S0 T1 reset election timeout. (HeartBeat: 2 -> 0, commitIndex 0)
004580 TIMR S1 T1 reset election timeout. (HeartBeat: 2 -> 1, commitIndex 0)
005113 CLNT S2 leader Term 1 append new log nextIndex2 matchIndex1
005162 LEAD S2 leader Term 1 Broadcast appendEntries
005163 LEAD S2 prevIndex0
005163 LEAD S2 prevIndex0
005370 LOG2 S0 follower Term1 append new log, len(rf.log) 1, args.PrevLogIndex 0
005370 WARN S0 follower Term1 append new log, len 2
005370 LOG2 S1 follower Term1 append new log, len(rf.log) 1, args.PrevLogIndex 0
005371 WARN S1 follower Term1 append new log, len 2
005373 LEAD S2 leader Term 1 appendEntries success: commitIndex1
005374 LEAD S2 leader Term 1 appendEntries success: commitIndex1
005469 CMIT S2 leader Term1 commit{CommandIndex:1}
005470 CMIT S2 leader Term1 commit
005576 TIMR S1 T1 reset election timeout. (HeartBeat: 2 -> 1, commitIndex 0)
005580 TIMR S0 T1 reset election timeout. (HeartBeat: 2 -> 0, commitIndex 0)
005677 CMIT S1 follower Term1 commit{CommandIndex:1}
005678 CMIT S1 follower Term1 commit
005679 CMIT S0 follower Term1 commit{CommandIndex:1}
005679 CMIT S0 follower Term1 commit
005780 CLNT S2 leader Term 1 append new log nextIndex3 matchIndex2
005934 LEAD S2 leader Term 1 Broadcast appendEntries
005935 LEAD S2 prevIndex1
005935 LEAD S2 prevIndex1
006783 LOG2 S0 follower Term1 append new log, len(rf.log) 2, args.PrevLogIndex 1
006784 WARN S0 follower Term1 append new log, len 3
006789 LOG2 S1 follower Term1 append new log, len(rf.log) 2, args.PrevLogIndex 1
006789 WARN S1 follower Term1 append new log, len 3
==================
WARNING: DATA RACE
Write at 0x00c0001202a0 by goroutine 51:
  6.824/raft.(*Raft).LeaderAppendEntries.func1()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:689 +0x488
  6.824/raft.(*Raft).LeaderAppendEntries.func2()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:705 +0xbc

Previous read at 0x00c0001202a0 by goroutine 32:
  6.824/raft.(*Raft).startHeartBeat.func1()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:379 +0xc0

Goroutine 51 (running) created at:
  6.824/raft.(*Raft).LeaderAppendEntries()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:665 +0x76c
  6.824/raft.Make.func2()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:780 +0x34

Goroutine 32 (running) created at:
  6.824/raft.(*Raft).startHeartBeat()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:370 +0xc0
  6.824/raft.(*Raft).startElection.func3()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:593 +0x34
==================
006882 LEAD S2 leader Term 1 appendEntries success: commitIndex2
006882 LEAD S2 leader Term 1 appendEntries success: commitIndex2
006910 CMIT S2 leader Term1 commit{CommandIndex:2}
006910 CMIT S2 leader Term1 commit
006912 TIMR S1 T1 reset election timeout. (HeartBeat: 2 -> 1, commitIndex 1)
006914 TIMR S0 T1 reset election timeout. (HeartBeat: 2 -> 0, commitIndex 1)
008269 TIMR S1 T1 reset election timeout. (HeartBeat: 2 -> 1, commitIndex 1)
008272 TIMR S0 T1 reset election timeout. (HeartBeat: 2 -> 0, commitIndex 1)
008363 CMIT S1 follower Term1 commit{CommandIndex:2}
008363 CMIT S1 follower Term1 commit
008364 CMIT S0 follower Term1 commit{CommandIndex:2}
008364 CMIT S0 follower Term1 commit
008470 CLNT S2 leader Term 1 append new log nextIndex4 matchIndex3
008526 LEAD S2 leader Term 1 Broadcast appendEntries
008533 LEAD S2 prevIndex2
008533 LEAD S2 prevIndex2
008570 LOG2 S1 follower Term1 append new log, len(rf.log) 3, args.PrevLogIndex 2
008570 WARN S1 follower Term1 append new log, len 4
008573 LEAD S2 leader Term 1 appendEntries success: commitIndex3
008586 LOG2 S0 follower Term1 append new log, len(rf.log) 3, args.PrevLogIndex 2
008586 WARN S0 follower Term1 append new log, len 4
008588 LEAD S2 leader Term 1 appendEntries success: commitIndex3
008634 CMIT S2 leader Term1 commit{CommandIndex:3}
008635 CMIT S2 leader Term1 commit
009306 TIMR S1 T1 reset election timeout. (HeartBeat: 2 -> 1, commitIndex 2)
009309 TIMR S0 T1 reset election timeout. (HeartBeat: 2 -> 0, commitIndex 2)
009352 CMIT S1 follower Term1 commit{CommandIndex:3}
009353 CMIT S1 follower Term1 commit
009353 CMIT S0 follower Term1 commit{CommandIndex:3}
009354 CMIT S0 follower Term1 commit
--- FAIL: TestBasicAgree2B (0.98s)
    testing.go:1465: race detected during execution of test
FAIL
exit status 1
FAIL	6.824/raft	2.484s

000017 LOG1 S0, making...
000022 LOG1 S1, making...
000023 LOG1 S2, making...
Test (2B): basic agreement ...
003571 TIMR S0 T0 follower election timeout, converting to Candidate
003583 VOTE S1 T0 vote for S0, converting to follower.
003583 TIMR S1 T1 reset election timeout. (RequestVote: 1 vote for 0)
003587 VOTE S2 T0 vote for S0, converting to follower.
003588 TIMR S2 T1 reset election timeout. (RequestVote: 2 vote for 0)
003590 LEAD S0 T1 achieved majority for term(2), 1 > 1 , converting to Leader! 
003603 TIMR S2 T1 reset election timeout. (HeartBeat: 0 -> 2, commitIndex 0)
003608 TIMR S1 T1 reset election timeout. (HeartBeat: 0 -> 1, commitIndex 0)
003622 CLNT S0 leader Term 1 append new log nextIndex2 matchIndex1
003733 LEAD S0 leader Term 1 Broadcast appendEntries
003733 LEAD S0 prevIndex0
003734 LEAD S0 prevIndex0
003773 LOG2 S1 follower Term1 append new log, len(rf.log) 1, args.PrevLogIndex 0
003773 WARN S1 follower Term1 append new log, len 2
003774 LEAD S0 leader Term 1 appendEntries success: commitIndex1
003812 LOG2 S2 follower Term1 append new log, len(rf.log) 1, args.PrevLogIndex 0
003813 WARN S2 follower Term1 append new log, len 2
003816 LEAD S0 leader Term 1 appendEntries success: commitIndex1
003835 CMIT S0 leader Term1 commit{CommandIndex:1}
003931 CMIT S0 leader Term1 commit
005213 TIMR S1 T1 reset election timeout. (HeartBeat: 0 -> 1, commitIndex 0)
005217 CMIT S1 follower Term1 commit{CommandIndex:1}
005217 CMIT S1 follower Term1 commit
006365 TIMR S2 T1 reset election timeout. (HeartBeat: 0 -> 2, commitIndex 0)
006449 CMIT S2 follower Term1 commit{CommandIndex:1}
006450 CMIT S2 follower Term1 commit
006503 CLNT S0 leader Term 1 append new log nextIndex3 matchIndex2
006553 LEAD S0 leader Term 1 Broadcast appendEntries
006553 LEAD S0 prevIndex1
006554 LEAD S0 prevIndex1
007239 LOG2 S1 follower Term1 append new log, len(rf.log) 2, args.PrevLogIndex 1
007240 WARN S1 follower Term1 append new log, len 3
==================
WARNING: DATA RACE
Write at 0x00c000122120 by goroutine 51:
  6.824/raft.(*Raft).LeaderAppendEntries.func1()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:687 +0x488
  6.824/raft.(*Raft).LeaderAppendEntries.func2()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:703 +0xbc

Previous read at 0x00c000122120 by goroutine 31:
  6.824/raft.(*Raft).startHeartBeat.func1()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:377 +0xc0

Goroutine 51 (running) created at:
  6.824/raft.(*Raft).LeaderAppendEntries()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:663 +0x76c
  6.824/raft.Make.func2()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:778 +0x34

Goroutine 31 (running) created at:
  6.824/raft.(*Raft).startHeartBeat()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:368 +0xb4
  6.824/raft.(*Raft).startElection.func3()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:591 +0x34
==================
007256 LEAD S0 leader Term 1 appendEntries success: commitIndex2
007262 LOG2 S2 follower Term1 append new log, len(rf.log) 2, args.PrevLogIndex 1
007262 WARN S2 follower Term1 append new log, len 3
007263 TIMR S1 T1 reset election timeout. (HeartBeat: 0 -> 1, commitIndex 1)
007263 TIMR S2 T1 reset election timeout. (HeartBeat: 0 -> 2, commitIndex 1)
007266 LEAD S0 leader Term 1 appendEntries success: commitIndex2
007343 CMIT S0 leader Term1 commit{CommandIndex:2}
007345 CMIT S0 leader Term1 commit
009172 TIMR S1 T1 reset election timeout. (HeartBeat: 0 -> 1, commitIndex 1)
009172 TIMR S2 T1 reset election timeout. (HeartBeat: 0 -> 2, commitIndex 1)
009846 CMIT S2 follower Term1 commit{CommandIndex:2}
009847 CMIT S2 follower Term1 commit
009847 CMIT S1 follower Term1 commit{CommandIndex:2}
009847 CMIT S1 follower Term1 commit
010486 CLNT S0 leader Term 1 append new log nextIndex4 matchIndex3
010750 TIMR S2 T1 reset election timeout. (HeartBeat: 0 -> 2, commitIndex 2)
010754 LEAD S0 leader Term 1 Broadcast appendEntries
010754 LEAD S0 prevIndex2
010755 LEAD S0 prevIndex2
010761 TIMR S1 T1 reset election timeout. (HeartBeat: 0 -> 1, commitIndex 2)
010764 LOG2 S1 follower Term1 append new log, len(rf.log) 3, args.PrevLogIndex 2
010764 WARN S1 follower Term1 append new log, len 4
010766 LEAD S0 leader Term 1 appendEntries success: commitIndex3
010777 LOG2 S2 follower Term1 append new log, len(rf.log) 3, args.PrevLogIndex 2
010778 WARN S2 follower Term1 append new log, len 4
010779 LEAD S0 leader Term 1 appendEntries success: commitIndex3
010863 CMIT S0 leader Term1 commit{CommandIndex:3}
010880 CMIT S0 leader Term1 commit
012465 TIMR S1 T1 reset election timeout. (HeartBeat: 0 -> 1, commitIndex 2)
012467 CMIT S1 follower Term1 commit{CommandIndex:3}
012467 CMIT S1 follower Term1 commit
012605 TIMR S2 T1 reset election timeout. (HeartBeat: 0 -> 2, commitIndex 2)
012837 CMIT S2 follower Term1 commit{CommandIndex:3}
012837 CMIT S2 follower Term1 commit
--- FAIL: TestBasicAgree2B (1.31s)
    testing.go:1465: race detected during execution of test
FAIL
exit status 1
FAIL	6.824/raft	2.641s

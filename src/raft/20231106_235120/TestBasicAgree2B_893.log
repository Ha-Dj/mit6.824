000042 LOG1 S0, making...
000049 LOG1 S1, making...
000050 LOG1 S2, making...
Test (2B): basic agreement ...
004245 TIMR S0 T0 follower election timeout, converting to Candidate
004259 VOTE S2 T0 vote for S0, converting to follower.
004259 TIMR S2 T1 reset election timeout. (RequestVote: 2 vote for 0)
004261 TIMR S1 T0 follower election timeout, converting to Candidate
004265 VOTE S1 T0 vote for S0, converting to follower.
004266 TIMR S1 T1 reset election timeout. (RequestVote: 1 vote for 0)
004268 LEAD S0 T1 achieved majority for term(2), 1 > 1 , converting to Leader! 
004270 VOTE S0 T1 vote for S1, converting to follower.
==================
WARNING: DATA RACE
Write at 0x00c0000d40f8 by goroutine 37:
  6.824/raft.(*Raft).RequestVote()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:413 +0x19c
  runtime.call32()
      /usr/local/go/src/runtime/asm_arm64.s:479 +0x74
  reflect.Value.Call()
      /usr/local/go/src/reflect/value.go:380 +0x90
  6.824/labrpc.(*Service).dispatch()
      /Users/dengjie/mit6.824/6.824/src/labrpc/labrpc.go:496 +0x334
  6.824/labrpc.(*Server).dispatch()
      /Users/dengjie/mit6.824/6.824/src/labrpc/labrpc.go:420 +0x1f0
  6.824/labrpc.(*Network).processReq.func1()
      /Users/dengjie/mit6.824/6.824/src/labrpc/labrpc.go:240 +0x84

Previous read at 0x00c0000d40f8 by goroutine 33:
  6.824/raft.(*Raft).startHeartBeat()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:367 +0x30
  6.824/raft.(*Raft).startElection.func3()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:591 +0x34

Goroutine 37 (running) created at:
  6.824/labrpc.(*Network).processReq()
      /Users/dengjie/mit6.824/6.824/src/labrpc/labrpc.go:239 +0x20c
  6.824/labrpc.MakeNetwork.func1.1()
      /Users/dengjie/mit6.824/6.824/src/labrpc/labrpc.go:157 +0x84

Goroutine 33 (finished) created at:
  6.824/raft.(*Raft).startElection()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:591 +0x550
  6.824/raft.(*Raft).ticker.func1()
      /Users/dengjie/mit6.824/6.824/src/raft/raft.go:615 +0x34
==================
004274 TIMR S0 T2 reset election timeout. (RequestVote: 0 vote for 1)
004276 VOTE S2 T1 vote for S1, converting to follower.
004277 TIMR S2 T2 reset election timeout. (RequestVote: 2 vote for 1)
007859 TIMR S2 T2 follower election timeout, converting to Candidate
007866 VOTE S1 T2 vote for S2, converting to follower.
007866 TIMR S1 T3 reset election timeout. (RequestVote: 1 vote for 2)
007867 VOTE S0 T2 vote for S2, converting to follower.
007867 TIMR S0 T3 reset election timeout. (RequestVote: 0 vote for 2)
007868 LEAD S2 T3 achieved majority for term(2), 1 > 3 , converting to Leader! 
007873 TIMR S1 T3 reset election timeout. (HeartBeat: 2 -> 1, commitIndex 0)
007876 TIMR S0 T3 reset election timeout. (HeartBeat: 2 -> 0, commitIndex 0)
008267 CLNT S2 leader Term 3 append new log nextIndex2 matchIndex1
008369 LEAD S2 leader Term 3 Broadcast appendEntries
008371 LEAD S2 prevIndex0
008371 LEAD S2 prevIndex0
008378 LOG2 S1 follower Term3 append new log, len(rf.log) 1, args.PrevLogIndex 0
008378 WARN S1 follower Term3 append new log, len 2
008378 LOG2 S0 follower Term3 append new log, len(rf.log) 1, args.PrevLogIndex 0
008379 WARN S0 follower Term3 append new log, len 2
008379 LEAD S2 leader Term 3 appendEntries success: commitIndex1
008382 LEAD S2 leader Term 3 appendEntries success: commitIndex1
008492 CMIT S2 leader Term3 commit{CommandIndex:1}
008493 CMIT S2 leader Term3 commit
009376 TIMR S0 T3 reset election timeout. (HeartBeat: 2 -> 0, commitIndex 0)
009377 TIMR S1 T3 reset election timeout. (HeartBeat: 2 -> 1, commitIndex 0)
009401 CMIT S1 follower Term3 commit{CommandIndex:1}
009402 CMIT S1 follower Term3 commit
009402 CMIT S0 follower Term3 commit{CommandIndex:1}
009403 CMIT S0 follower Term3 commit
009584 CLNT S2 leader Term 3 append new log nextIndex3 matchIndex2
009656 LEAD S2 leader Term 3 Broadcast appendEntries
009657 LEAD S2 prevIndex1
009658 LEAD S2 prevIndex1
009664 LOG2 S1 follower Term3 append new log, len(rf.log) 2, args.PrevLogIndex 1
009664 LOG2 S0 follower Term3 append new log, len(rf.log) 2, args.PrevLogIndex 1
009665 WARN S0 follower Term3 append new log, len 3
009664 WARN S1 follower Term3 append new log, len 3
009666 LEAD S2 leader Term 3 appendEntries success: commitIndex2
009668 LEAD S2 leader Term 3 appendEntries success: commitIndex2
009785 CMIT S2 leader Term3 commit{CommandIndex:2}
009786 CMIT S2 leader Term3 commit
010880 TIMR S1 T3 reset election timeout. (HeartBeat: 2 -> 1, commitIndex 1)
010881 TIMR S0 T3 reset election timeout. (HeartBeat: 2 -> 0, commitIndex 1)
011051 CMIT S0 follower Term3 commit{CommandIndex:2}
011052 CMIT S0 follower Term3 commit
011052 CMIT S1 follower Term3 commit{CommandIndex:2}
011052 CMIT S1 follower Term3 commit
011227 CLNT S2 leader Term 3 append new log nextIndex4 matchIndex3
011261 LEAD S2 leader Term 3 Broadcast appendEntries
011262 LEAD S2 prevIndex2
011262 LEAD S2 prevIndex2
011270 LOG2 S0 follower Term3 append new log, len(rf.log) 3, args.PrevLogIndex 2
011271 WARN S0 follower Term3 append new log, len 4
011273 LEAD S2 leader Term 3 appendEntries success: commitIndex3
011274 CMIT S2 leader Term3 commit{CommandIndex:3}
011274 CMIT S2 leader Term3 commit
011280 LOG2 S1 follower Term3 append new log, len(rf.log) 3, args.PrevLogIndex 2
011280 WARN S1 follower Term3 append new log, len 4
011282 LEAD S2 leader Term 3 appendEntries success: commitIndex3
012437 TIMR S0 T3 reset election timeout. (HeartBeat: 2 -> 0, commitIndex 2)
012439 TIMR S1 T3 reset election timeout. (HeartBeat: 2 -> 1, commitIndex 2)
012645 CMIT S0 follower Term3 commit{CommandIndex:3}
012645 CMIT S1 follower Term3 commit{CommandIndex:3}
012646 CMIT S1 follower Term3 commit
012645 CMIT S0 follower Term3 commit
--- FAIL: TestBasicAgree2B (1.30s)
    testing.go:1465: race detected during execution of test
FAIL
exit status 1
FAIL	6.824/raft	8.478s
